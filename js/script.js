var database = $.parseJSON('{"lista":[{"id":"c0","nome":"categoria 0","img":"","prodotti":[{"id":"p0","titolo":"prodotto 0","sottotitolo":"subtitp 0","codice":"0138197","prezzo":"088","img":"prodotto0.jpg","testo":"prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p1","titolo":"prodotto 1","sottotitolo":"subtitp 1","codice":"1725953","prezzo":"111","img":"prodotto0.jpg","testo":"prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p2","titolo":"prodotto 2","sottotitolo":"subtitp 2","codice":"2203268","prezzo":"210","img":"prodotto0.jpg","testo":"prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p3","titolo":"prodotto 3","sottotitolo":"subtitp 3","codice":"3192978","prezzo":"362","img":"prodotto0.jpg","testo":"prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p4","titolo":"prodotto 4","sottotitolo":"subtitp 4","codice":"4277073","prezzo":"449","img":"prodotto0.jpg","testo":"prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0prodotto0","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]}]},{"id":"c1","nome":"categoria 1","img":"","prodotti":[{"id":"p0","titolo":"prodotto 0","sottotitolo":"subtitp 0","codice":"0127559","prezzo":"021","img":"prodotto1.jpg","testo":"prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p1","titolo":"prodotto 1","sottotitolo":"subtitp 1","codice":"1144728","prezzo":"115","img":"prodotto1.jpg","testo":"prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p2","titolo":"prodotto 2","sottotitolo":"subtitp 2","codice":"2569856","prezzo":"287","img":"prodotto1.jpg","testo":"prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p3","titolo":"prodotto 3","sottotitolo":"subtitp 3","codice":"3408308","prezzo":"393","img":"prodotto1.jpg","testo":"prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p4","titolo":"prodotto 4","sottotitolo":"subtitp 4","codice":"4145515","prezzo":"414","img":"prodotto1.jpg","testo":"prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1prodotto1","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]}]},{"id":"c2","nome":"categoria 2","img":"","prodotti":[{"id":"p0","titolo":"prodotto 0","sottotitolo":"subtitp 0","codice":"0580132","prezzo":"014","img":"prodotto2.jpg","testo":"prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p1","titolo":"prodotto 1","sottotitolo":"subtitp 1","codice":"1166651","prezzo":"111","img":"prodotto2.jpg","testo":"prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p2","titolo":"prodotto 2","sottotitolo":"subtitp 2","codice":"2163241","prezzo":"225","img":"prodotto2.jpg","testo":"prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p3","titolo":"prodotto 3","sottotitolo":"subtitp 3","codice":"3946974","prezzo":"389","img":"prodotto2.jpg","testo":"prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p4","titolo":"prodotto 4","sottotitolo":"subtitp 4","codice":"4186436","prezzo":"419","img":"prodotto2.jpg","testo":"prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2prodotto2","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]}]},{"id":"c3","nome":"categoria 3","img":"","prodotti":[{"id":"p0","titolo":"prodotto 0","sottotitolo":"subtitp 0","codice":"0316730","prezzo":"010","img":"prodotto3.jpg","testo":"prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p1","titolo":"prodotto 1","sottotitolo":"subtitp 1","codice":"1706844","prezzo":"110","img":"prodotto3.jpg","testo":"prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p2","titolo":"prodotto 2","sottotitolo":"subtitp 2","codice":"2113627","prezzo":"259","img":"prodotto3.jpg","testo":"prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p3","titolo":"prodotto 3","sottotitolo":"subtitp 3","codice":"3208668","prezzo":"320","img":"prodotto3.jpg","testo":"prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p4","titolo":"prodotto 4","sottotitolo":"subtitp 4","codice":"4654231","prezzo":"421","img":"prodotto3.jpg","testo":"prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3prodotto3","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]}]},{"id":"c4","nome":"categoria 4","img":"","prodotti":[{"id":"p0","titolo":"prodotto 0","sottotitolo":"subtitp 0","codice":"0388684","prezzo":"019","img":"prodotto4.jpg","testo":"prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p1","titolo":"prodotto 1","sottotitolo":"subtitp 1","codice":"1175370","prezzo":"118","img":"prodotto4.jpg","testo":"prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p2","titolo":"prodotto 2","sottotitolo":"subtitp 2","codice":"2134423","prezzo":"274","img":"prodotto4.jpg","testo":"prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p3","titolo":"prodotto 3","sottotitolo":"subtitp 3","codice":"3565328","prezzo":"317","img":"prodotto4.jpg","testo":"prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]},{"id":"p4","titolo":"prodotto 4","sottotitolo":"subtitp 4","codice":"4167745","prezzo":"420","img":"prodotto4.jpg","testo":"prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4prodotto4","varianti":[{"label":"variante0","detail":"variante detail0"},{"label":"variante1","detail":"variante detail1"},{"label":"variante2","detail":"variante detail2"}],"documenti":[{"nome":"documento0","path":"documentopath0.pdf"},{"nome":"documento1","path":"documentopath1.pdf"}]}]}]}');

            $.domHooks({
                'body' :function(sel,$body){
    
                    var isiPad = (/iPad/i).test(navigator.userAgent);


                    var isiPad = true;

                    if ( isiPad ) {
                        $body.addClass('isIpad');
                    }
                    else {
                        $body.addClass('isSmartphone');
                    }

                    //download the productlist NOT IN LOCAL
                    
                    $.ajax({
                      url: "./prodotti.json"
                    }).done(function(response) {
                        $body.addClass("done");
                        database = $.parseJSON(response);

                        //after download productlist then i fill the menu
                        var $menuProdotti = $('.menu-prodotti ul');
                        $menuProdotti.html('');


                        $(database.lista).each(function(i,el){
                            $menuProdotti.append('<li><a href="javascript:;" data-target="#category-list" data-cat="'+el.id+'">'+el.nome+'</a></li>');                        

                        });
                    });

                    //after download productlist then i fill the menu
                        var $menuProdotti = $('.menu-prodotti ul');
                        $menuProdotti.html('');


                        $(database.lista).each(function(i,el){
                            $menuProdotti.append('<li><a href="javascript:;" data-target="#category-list" data-cat="'+el.id+'">'+el.nome+'</a></li>');                        

                        });


                    $(document).on(
                        'click',
                        '.product-listitem li a',
                        function(){

                            loadProdotto($(this).data('cat'),$(this).data('prodotto'));

                            return false;
                        }
                    )

                    $(document).on(
                        'click',
                        '#menu li a',
                        function(){

                            if ( $(this).data('target') != null ) {
                                $('.button-menu').trigger('click');

                                $('.product-listitem-container').removeAttr('style');

                                $('#wrapper').find('.layer-interna-show').removeClass('layer-interna-show');
                                $($(this).data('target')).addClass('layer-interna-show');


                                //fill the category layer
                                if ( $(this).data('cat') != null ) loadListaProdotti($(this).data('cat'));
                            }
                            return false;
                        }
                    )
                    

                    $(document).on(
                        'click',
                        '.prodotto-toolbox li',
                        function(){
                            $productDetail = $('.product-detail');

                            var layerattivo = $productDetail.attr('data-layerattivo');

                            if ( layerattivo!= "" ) $productDetail.removeClass('product-detail-layer-'+layerattivo+'-show');
                            
                            var layer = $(this).attr('class').replace('prodotto-toolbox-','');

                            $productDetail.addClass('product-detail-layer-'+layer+'-show');

                            $productDetail.attr('data-layerAttivo',layer);


                            //active clicked voice
                            $(this).parent().find('.prodotto-toolbox-active').removeClass('prodotto-toolbox-active');
                            $(this).addClass('prodotto-toolbox-active');
                        }
                    )

                },
                '.button-menu': function (selector, $buttonMenu) {
                    var $wrapper = $('#wrapper'),
                        $menu = $('#menu'),
                        menuWidth = $menu.width();

                    $buttonMenu.click(function(){
                        if ( !$wrapper.is(':animated') )  {
                            //if wrapper is not animated 
                            
                            if ( !$menu.hasClass('menu-open') ) {
                                //if menu isn't visible
                                $wrapper.animate({
                                    marginLeft: menuWidth+'px',
                                }, 300, function(){$menu.addClass('menu-open')});
                            }
                            else {
                                $wrapper.animate({
                                    marginLeft: 0,
                                }, 300, function(){$menu.removeClass('menu-open')});
                            }
                        }
                    }); 
                }
                
            });
            function loadListaProdotti( id ){
                var $menuCategorie = $('.product-listitem');

                $menuCategorie.html('');
                $('.product-detail').removeClass('product-detail-show');

                $(database.lista).each(function(i,el){
                    if ( el.id == id ){

                        $('#category-title').html(el.nome);
                        //found the category then print elements

                        $(el.prodotti).each(function(j,menu){

                            $menuCategorie.append('<li class="clearfix">'+
                                '<a href="javascript:;" class="clearfix" data-cat="'+id+'" data-prodotto='+menu.id+'>'+
                                    '<div class="prodotto-img"><img src="img/t_'+menu.img+'" class="" /></div>'+
                                    '<p class="prodotto-titolo">'+menu.titolo+'</p>'+
                                    '<p class="prodotto-sottotitolo">'+menu.sottotitolo+'</p>'+
                                    '<p class="prodotto-codice">'+menu.codice+'</p>'+
                                '</a>'+
                                '<ul class="prodotto-toolbox"><li class="prodotto-toolbox-info">Info</li><li class="prodotto-toolbox-scheda">Scheda</li><li class="prodotto-toolbox-doc">Documenti</li><li class="prodotto-toolbox-video">Video</li><li class="prodotto-toolbox-foto">Foto</li></ul>'+
                            '</li>')
                        });

                    }
                });               

            }
            function loadProdotto( idCat, idProd ){

                //first animation..
                $body = $('body');
                if ( $body.hasClass('isSmartphone') ) {

                    $('.product-listitem-container').animate({
                        marginLeft: "-100%",
                    });

                }
                else {
                    $('.showToolbox').removeClass('showToolbox');
                    $('a[data-prodotto="'+idProd+'"]').parent().addClass('showToolbox');
                }
               
               $(database.lista).each(function(i,el){
                    if ( el.id == idCat ){ //found category then find product
                        $(el.prodotti).each(function(j,prodotto){
                            if ( prodotto.id == idProd ) { //found prodotto
                                $productDetail = $('.product-detail');

                                $productDetail.html('');

                                var $prodInfo = $('<div class="product-detail-layer product-detail-layer-info"  />');
                                var $prodScheda = $('<div class="product-detail-layer product-detail-layer-scheda"  />');
                                var $prodDoc = $('<div class="product-detail-layer product-detail-layer-doc"  />');
                                var $prodVideo = $('<div class="product-detail-layer product-detail-layer-video" />');
                                var $prodFoto = $('<div class="product-detail-layer product-detail-layer-foto"  />');


                                $productDetail.append('<h1>'+prodotto.titolo+' <span>'+prodotto.sottotitolo+'</span><div class="prodotto-icona" /></h1>');
                                $productDetail.append('<div class="prodotto-img"><img src="img/m_'+prodotto.img+'" /></div>');

                                $productDetail.append('<ul class="prodotto-toolbox"><li class="prodotto-toolbox-info">Info</li><li class="prodotto-toolbox-scheda">Scheda</li><li class="prodotto-toolbox-doc">Documenti</li><li class="prodotto-toolbox-video">Video</li><li class="prodotto-toolbox-foto">Foto</li></ul>');


                                $prodInfo.append('<div class="prodotto-info"><div class="fll-left">'+prodotto.codice+'</div><div class="fll-right">'+prodotto.prezzo+'€</div></div>');

                                $prodInfo.append('<div class="prodotto-testo">'+prodotto.testo+'</div>');

                               

                                $(prodotto.varianti).each(function(i,variante){

                                    $prodScheda.append('<div class="">Variante'+i+'</div>');

                                });

                                $(prodotto.documenti).each(function(i,doc){

                                    $prodDoc.append('<article class="prodotto-documento"><a href="'+doc.path+'">'+doc.nome+'</a></article>');

                                });


                                $productDetail.append($prodInfo);
                                $productDetail.append($prodScheda);
                                $productDetail.append($prodDoc);
                                $productDetail.append($prodVideo);
                                $productDetail.append($prodFoto);

                                if ( !$productDetail.hasClass('product-detail-show')) $productDetail.addClass('product-detail-show');
                                
                                //accendo le info
                                $('.prodotto-toolbox-info').trigger('click');
                            }
                        });
                    }
                })






                

            }